- name: ArgoCD | Wait up for running ArgoCD Server service
  uri:
    url: "https://{{ argocd_subdomain }}.{{ custom_domain_name }}/api/version"
    validate_certs: no
  register: argocd_server_health_result
  until: argocd_server_health_result.status == 200
  retries: 60
  delay: 10

- name: ArgoCD | Copy item
  template:
    src: "{{ item }}.j2"
    dest: "{{ kube_config_dir }}/addons/argocd/{{ item }}"
  with_items: ["argocd-set-password-to-admin.sh"]

- name: ArgoCD | Set init password to admin
  ansible.builtin.shell: |
    sudo chmod +755 ./argocd-set-password-to-admin.sh
    sudo ./argocd-set-password-to-admin.sh
  args:
    chdir: "{{ kube_config_dir }}/addons/argocd"
  ignore_errors: true